<ng-container *appToolbarContent>
  <button *requireRole="'admin,hr'" mat-button (click)="showAllPeople()">
    <mat-icon mat-list-icon>person_add</mat-icon>
    Show all people
  </button>
</ng-container>

<div class="main-card">
  <mat-card>
    <form #leaveForm="ngForm" (submit)="submit()" id="form" class="two-colum-grid">
      <mat-form-field>
        <mat-select name="person"
                    [(ngModel)]="leaveRequest.personId"
                    (ngModelChange)="personSelectedChanged($event)"
                    required
                    [disabled]="!(loginService.hasAnyRole(['admin', 'hr']) | async)"
                    placeholder="Person Leaving">
          <mat-option>None</mat-option>
          <mat-option *ngFor="let eachPerson of people" [value]="eachPerson.person.id">
            {{eachPerson.person.preferredName}}
          </mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <mat-select name="type" required placeholder="Type" [(ngModel)]="leaveRequest.type">
          <mat-option value="Vacation">Vacation</mat-option>
          <mat-option value="Sick">Sick</mat-option>
          <mat-option value="Personal">Personal</mat-option>
          <mat-option value="Funeral">Funeral</mat-option>

          <!--todo only show mat/pat ernity leave based on gender-->
          <mat-option *ngIf="selectedPerson?.person.gender == 'Male'" value="Maternity">Maternity</mat-option>
          <mat-option *ngIf="selectedPerson?.person.gender == 'Female'" value="Paternity">Paternity</mat-option>

          <mat-option value="Buisness">Buisness</mat-option>
          <mat-option value="Compensation">Compensation</mat-option>
          <mat-option value="NonPaid">Non-Paid</mat-option>
          <mat-option value="Other">Other</mat-option>
        </mat-select>
      </mat-form-field>
      <mat-form-field>
        <input name="startDate" required matInput [(ngModel)]="leaveRequest.startDate"
               [matDatepicker]="startDatePicker"
               placeholder="Start Date">
        <mat-datepicker-toggle matSuffix [for]="startDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #startDatePicker></mat-datepicker>
      </mat-form-field>
      <mat-form-field>
        <input name="endDate" required matInput [(ngModel)]="leaveRequest.endDate"
               [matDatepicker]="endDatePicker"
               placeholder="End Date">
        <mat-datepicker-toggle matSuffix [for]="endDatePicker"></mat-datepicker-toggle>
        <mat-datepicker #endDatePicker></mat-datepicker>
      </mat-form-field>

      <mat-form-field class="span-2-columns">
          <textarea matInput [(ngModel)]="leaveRequest.reason"
                    name="reason"
                    placeholder="Reason"></textarea>
      </mat-form-field>

      <div class="span-2-columns">
        <div class="mat-caption">Leave days used/total</div>
        <mat-chip-list>
          <ng-container *ngFor="let leave of selectedPerson?.leaveUseages">
            <!--the if is here to hide paternity when the person is female and maternity when person is male-->
            <mat-chip *ngIf="leave.leaveType != (selectedPerson.person.gender == 'Male' ? 'Maternity' : 'Paternity')"
                      color="accent" selected="true">
              {{leave.leaveType}} {{leave.used}}/{{leave.totalAllowed}}
            </mat-chip>
          </ng-container>
        </mat-chip-list>
      </div>
    </form>

    <mat-card-actions>
      <button type="submit" form="form" [disabled]="!leaveForm.form.valid" mat-button>
        {{isNew ? 'Request Leave' : 'Save'}}
      </button>
      <button mat-button *ngIf="!isNew" color="warn" (click)="deleteRequest()">Delete Request</button>
    </mat-card-actions>
  </mat-card>
</div>
